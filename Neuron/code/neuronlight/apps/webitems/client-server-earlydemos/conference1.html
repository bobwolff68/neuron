<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.2//EN" "http://www.openmobilealliance.org/tech/DTD/xhtml-mobile12.dtd">
    <html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
        <meta http-equiv="cache-control" content="max-age=200" />
                
	<link href="indexstyle.css" media="handheld, screen" rel="stylesheet" type="text/css" />
                
	<title>XVDTH Video</title>
                        
        <style type="text/css">
  		html { height: 100% }
  		body { height: 100%; margin: 0px; padding: 0px; font-family:courier}
  		#map_canvas { height: 100% }
	</style>

        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>

        <script type="text/javascript"> 
            var player1 = null;
            var member = new Array();
            
            function registerVLCEvent(event, handler){
                //alert('register event');
                var vlc = getVLC("vlc");
                if (vlc) {
                    if (vlc.attachEvent) {
                        // Microsoft
                        vlc.attachEvent (event, handler);
                    } else 
                        if (vlc.addEventListener) {
                            // Mozilla: DOM level 2
                            vlc.addEventListener (event, handler, false);
                        } else {
                            // DOM level 0
                            vlc["on" + event] = handler;
                        }
                    }
            }
            
            // stop listening to event
            function unregisterVLCEvent(event, handler){
                var vlc = getVLC("vlc");
                if (vlc) {
                    if (vlc.detachEvent) {
                        // Microsoft
                        vlc.detachEvent (event, handler);
                    } else 
                        if (vlc.removeEventListener) {
                            // Mozilla: DOM level 2
                            vlc.removeEventListener (event, handler, false);
                        } else {
                            // DOM level 0
                            vlc["on" + event] = null;
                        }
                    }
            }
            
            // event callback function for testing
            function handleEvents(event){
                if (!event)
                    event = window.event; // IE
                    if (event.target) {
                        // Netscape based browser
                        targ = event.target;
                    } else {
                        if (event.srcElement) {
                            // ActiveX
                            targ = event.srcElement;
                        } else {
                            // No event object, just the value
                            alert("Event value" + event );
                            return;
                        }
                    }
                    
                    if (targ.nodeType == 3){ // defeat Safari bug
                        targ = targ.parentNode;
                    }
                    alert("Event " + event.type + " has fired from " + targ );
            }
            
            // handle mouse grab event from video filter
            function handleMouseGrab(event,X,Y){
                if (!event){
                    event = window.event; // IE
                }
                alert("new position (" + X + "," + Y + ")");
            }
            
            // Register a bunch of callbacks.
            registerVLCEvent('MediaPlayerNothingSpecial', handleEvents);
            registerVLCEvent('MediaPlayerOpening', handleEvents);
            registerVLCEvent('MediaPlayerBuffering', handleEvents);
            registerVLCEvent('MediaPlayerPlaying', handleEvents);
            registerVLCEvent('MediaPlayerPaused', handleEvents);
            registerVLCEvent('MediaPlayerForward', handleEvents);
            registerVLCEvent('MediaPlayerBackward', handleEvents);
            registerVLCEvent('MediaPlayerEncounteredError', handleEvents);
            registerVLCEvent('MediaPlayerEndReached', handleEvents);
            registerVLCEvent('MediaPlayerTimeChanged', handleEvents);
            registerVLCEvent('MediaPlayerPositionChanged', handleEvents);
            registerVLCEvent('MediaPlayerSeekableChanged', handleEvents);
            registerVLCEvent('MediaPlayerPausableChanged', handleEvents);
            
            function check(){
            //alert('check called');
            
                downloadUrl("checkupdate.php", function(data){
                    var xml = data.responseXML;
                    var puser = xml.documentElement.getElementsByTagName("participant");
                    //<![CDATA[
                        for (i = 0; i < puser.length ; i++) {
                            var prec = new Array(
	                        puser[i].getAttribute("username"),
                                puser[i].getAttribute("ip"),
                                puser[i].getAttribute("portv"),
                                puser[i].getAttribute("porta")
                            );
                            member.push(prec);
                        }
                    //]]>
                    var a1 = document.getElementById("xfile");
                    var lastlocationurl = a1.value;
                    switch (puser.length) {
                        case 1:
                            a1.value = 'conference1.html';
                        break;
                        
                        case 2:
                            //a1.value = 'conference2.html';
                            var p1 = document.getElementById("vlc1");
                            p1.stop();
                            p1.vlc.playlist.items.clear();
                            var options = new Array(":aspect-ratio=4:3", "--rtsp-tcp");
                            var id22 = vlc.playlist.add("rtsp://servername/item/to/play", "fancy name", null);
                            vlc.playlist.playItem(id22);
                        break;
                        
                        case 3:
                            a1.value = '3.html';
                        break;
                        
                        case 4:
                            a1.value = '4.html';
                        break;
                        
                        default:
                            a1.value = 'd.html';
                        break;
                    }
                    if (a1.value != lastlocationurl){
                        var locationObj = document.location;
                        //document.location = 'http://www.mozilla.org';
                        document.location = a1.value;
                    }else{
                        var t=setTimeout("check()",5000);
                    }
                });
            }
        
            function load(){
                var w = document.getElementById("uri");                
                //player.play('rtsp://184.72.239.149/vod/mp4:BigBuckBunny_175k.mov');
                //player1.togglePause();
                //player1.play(w.value);
            }
        
            $(document).ready(function() { 

                downloadUrl("sessionrecord.php", function(data){
                    var xml = data.responseXML;
                    var puser = xml.documentElement.getElementsByTagName("participant");
                    //<![CDATA[
                        for (i = 0; i < puser.length ; i++) {
                            var prec = new Array(
	                        puser[i].getAttribute("username"),
                                puser[i].getAttribute("ip"),
                                puser[i].getAttribute("portv"),
                                puser[i].getAttribute("porta")
                            );
                            member.push(prec);
                        }
                    //]]>
                    switch (puser.length) {
                        case 1:
                            var a1 = document.getElementById("uri");
                            a1.value = member[0][1];
                        break;
                        
                        case 2:
                            a1.value = 'conference2.html';
                        break;
                        
                        case 3:
                            a1.value = '3.html';
                        break;
                        
                        case 4:
                            a1.value = '4.html';
                        break;
                        
                        default:
                            //a1.value = 'd.html';
                        break;
                    }
                    // var a1 = document.getElementById("uri");
                    // a1.value = member[0][1];
                    // var a2 = document.getElementById("uri2");
                    // a2.value = member[1][1];                       
                });
                
                //player.play('http://download.blender.org/peach/bigbuckbunny_movies/big_buck_bunny_480p_surround-fix.avi');
                //player.play('http://www.revolunet.com/static/download/labo/VLCcontrols/bunny.mp4');
                //var player2 = VLCobject.embedPlayer('vlc2', 160, 120, true);
                //player2.play('http://download.blender.org/peach/bigbuckbunny_movies/big_buck_bunny_480p_surround-fix.avi');
                //http://www.revolunet.com/static/download/labo/VLCcontrols/bunny.mp4
                //VLCobject.addToolbar('vlc1');
            });        

            function downloadUrl(url, callback) {
                var request = window.ActiveXObject ?
                new ActiveXObject('Microsoft.XMLHTTP') :
                new XMLHttpRequest;

                request.onreadystatechange = function() {
                    if (request.readyState == 4) {
                        request.onreadystatechange = doNothing;
                        callback(request, request.status);
                    }
                };

                request.open('GET', url, true);
                request.send(null);
            }

            function doNothing(){   
            }

            google.maps.event.addDomListener(window, 'load', load);
            
        </script> 
        
    </head> 
    
    <body onload="load">
        
        <script type="text/javascript"> 
            check();
        </script>
        
        <div id='vlce1'>player 1
            <embed type="application/x-vlc-plugin" pluginspage="http://www.videolan.org" version="VideoLAN.VLCPlugin.2"
                width="320"
                height="240"
                id="vlc1"/>
                <!-- 
                autoplay="yes" loop="no"
                target="rtsp://184.72.239.149/vod/mp4:BigBuckBunny_175k.mov"            
                / -->        
   
            <!-- input id='uri' value='http://www.revolunet.com/static/download/labo/VLCcontrols/bunny.mp4' size=70 type='text' -->
            <!-- input id='uri' value='http://download.blender.org/peach/bigbuckbunny_movies/big_buck_bunny_480p_surround-fix.avi' size=70 type='text' -->
            <!--input id='uri' value='rtsp://184.72.239.149/vod/mp4:BigBuckBunny_175k.mov' size=70 type='text'-->
            <!--input id='uri' value='rtsp://192.168.46.81:8554/serenity.ts' size=70 type='text'-->
            <!--input id='uri' value='rtsp://192.168.46.81:8554/stream1.sdp' size=70 type='text'-->                    <!--input id='uri' value='file:///Users/xvdthuser1xvdth/media/vlc-output.ts' size='70' type='text'/-->
            <!--input id='uri' value="rpurl" size='70' type='text' name="vevo"/-->
            <input id='uri' value='url1 here' type='hidden' name="vevo"/>        
            <input id='xfile' value='conference1.html' type='hidden' name="vevo"/>
        </div>
         
    </body> 
</html> 